{% extends "base.html" %}
{% block content %}

<h1>Configure Monitoring</h1>
<p class="subtitle">
System: <strong>{{ system.name }}</strong> |
Environment: <strong>{{ system.environment }}</strong>
</p>

<div class="card">
    <h2>Add Monitor</h2>
    <form method="post" class="form-grid">
        <select name="type">
            <option>APPLICATION</option>
            <option>INBOUND</option>
            <option>OUTBOUND</option>
        </select>
        <input name="url" placeholder="Endpoint URL" required>
        <button class="btn primary">Add Monitor</button>
    </form>
</div>

<div class="card">
    <h2>Configured Monitors</h2>

    <table class="styled-table">
        <tr>
            <th>Type</th>
            <th>Endpoint</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>

        {% for m in monitors %}
        <tr>
            <td>{{ m.monitor_type }}</td>
            <td class="mono">{{ m.endpoint_url }}</td>
            <td>
                <span class="status {{ 'success' if m.is_active else 'warning' }}">
                    {{ 'Active' if m.is_active else 'Inactive' }}
                </span>
            </td>
            <td>
                {% if m.is_active %}
                    <a class="btn small danger"
                       href="/admin/monitor/{{ m.id }}/inactivate"
                       onclick="return confirm('Inactivate this monitor?')">
                        Inactivate
                    </a>
                {% else %}
                    <a class="btn small success"
                       href="/admin/monitor/{{ m.id }}/activate"
                       onclick="return confirm('Activate this monitor?')">
                        Activate
                    </a>
                {% endif %}

                <form method="post"
                      action="/admin/monitor/{{ m.id }}/delete"
                      style="display:inline"
                      onsubmit="return confirmDelete(this)">
                    <input type="hidden" name="note">
                    <button class="btn small danger">Delete</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>
</div>

<script>
function confirmDelete(form) {
    const note = prompt("Reason for deletion (mandatory):");
    if (!note) return false;
    form.note.value = note;
    return true;
}
</script>

{% endblock %}
