<!DOCTYPE html>
<html lang="en">
<head>
    <title>Shell – Enterprise Monitoring Dashboard</title>

    <style>
        :root {
            --shell-yellow: #ffd500;
            --shell-dark: #1f2937;
            --shell-gray: #6b7280;
            --shell-border: #e5e7eb;
            --shell-bg: #f9fafb;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            margin: 0;
            background: var(--shell-bg);
            font-family: system-ui, -apple-system, BlinkMacSystemFont;
            color: var(--shell-dark);
        }

        /* ================= NAVBAR ================= */

        .navbar {
            position: sticky;
            top: 0;
            z-index: 100;
            background: #ffffff;
            border-bottom: 1px solid var(--shell-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 40px;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .nav-left img {
            height: 36px;
        }

        .nav-title {
            font-weight: 600;
            font-size: 18px;
        }

        .nav-right a {
            margin-left: 28px;
            text-decoration: none;
            font-weight: 500;
            color: var(--shell-dark);
        }

        .nav-right a:hover {
            color: #000;
        }

        /* ================= PAGE LAYOUT ================= */

        .container {
            padding: 40px;
        }

        h2 {
            margin: 60px 0 15px;
            color: #374151;
        }

        /* ================= TABLE ================= */

        table {
            width: 100%;
            max-width: 1100px;
            border-collapse: collapse;
            background: #ffffff;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--shell-border);
        }

        th, td {
            padding: 14px 16px;
            text-align: center;
            font-size: 14px;
        }

        th {
            background: #f3f4f6;
            font-size: 12px;
            text-transform: uppercase;
            color: var(--shell-gray);
            border-bottom: 1px solid var(--shell-border);
        }

        td:first-child {
            text-align: left;
            font-weight: 500;
        }

        tr {
            border-bottom: 1px solid var(--shell-border);
        }

        tr:last-child {
            border-bottom: none;
        }

        tr.hidden {
            display: none;
        }

        /* ================= STATUS ================= */

        .checking {
            color: #2563eb;
            font-weight: 500;
        }

        .success {
            color: #16a34a;
            font-weight: 600;
        }

        .failure {
            color: #dc2626;
            font-weight: 600;
        }

        .ok {
            color: #16a34a;
            font-size: 18px;
            font-weight: bold;
        }

        .fail {
            color: #dc2626;
            font-size: 18px;
            font-weight: bold;
        }

        /* ================= SPINNER ================= */

        .spinner {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 3px solid #d1d5db;
            border-top: 3px solid #2563eb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ================= BUTTON ================= */

        .shell-btn {
            display: inline-block;
            margin: 10px 0 20px;
            background: var(--shell-yellow);
            color: #000;
            padding: 10px 18px;
            border-radius: 20px;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
        }

        .shell-btn:hover {
            background: #facc15;
        }
    </style>
</head>

<body>

<!-- ================= NAVBAR ================= -->

<div class="navbar">
    <div class="nav-left">
        <img src="https://upload.wikimedia.org/wikipedia/en/thumb/e/e8/Shell_logo.svg/120px-Shell_logo.svg.png"
             alt="Shell Logo">
        <span class="nav-title">Enterprise Monitoring</span>
    </div>
    <div class="nav-right">
        <a href="#app-health">Application Health</a>
        <a href="#integration-health">Integration Status</a>
    </div>
</div>

<div class="container">

<!-- ================================================= -->
<!-- APPLICATION SERVICE HEALTH (SEQUENTIAL) -->
<!-- ================================================= -->

<section id="app-health">
    <h2>Application Service Health</h2>

    <table>
        <thead>
            <tr>
                <th>Service</th>
                <th>Endpoint</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody id="rows">
            {% for s in services %}
            <tr id="row-{{ loop.index0 }}"
                class="{% if not loop.first %}hidden{% endif %}">
                <td>{{ s.name }}</td>
                <td>{{ s.url }}</td>
                <td class="status">
                    {% if loop.first %}
                    <span class="spinner"></span>
                    <span class="checking"> Checking...</span>
                    {% else %}
                    —
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>

<!-- ================================================= -->
<!-- INTEGRATION CONNECTIVITY (SEQUENTIAL) -->
<!-- ================================================= -->

<section id="integration-health">
    <h2>Integration Connectivity Status</h2>

    <table>
        <thead>
            <tr>
                <th rowspan="2">System</th>
                <th colspan="2">Connectivity</th>
                <th colspan="2">Transactions (Last 1 Day)</th>
            </tr>
            <tr>
                <th>Outbound</th>
                <th>Inbound</th>
                <th>Outbound</th>
                <th>Inbound</th>
            </tr>
        </thead>
        <tbody id="integration-rows">
            {% for s in systems %}
            <tr id="integration-row-{{ loop.index0 }}"
                class="{% if not loop.first %}hidden{% endif %}">
                <td>{{ s.name }}</td>
                <td class="outbound">—</td>
                <td class="inbound">—</td>
                <td>--</td>
                <td>--</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>

</div>

<!-- ================================================= -->
<!-- JAVASCRIPT -->
<!-- ================================================= -->

<script>
    /* ================= APPLICATION SERVICE CHECK ================= */

    const totalServices = {{ services|length }};
    let currentService = 0;

    async function runServiceChecks() {
        while (currentService < totalServices) {
            const row = document.getElementById(`row-${currentService}`);
            row.classList.remove("hidden");

            const statusCell = row.querySelector(".status");
            statusCell.innerHTML =
                `<span class="spinner"></span>
                 <span class="checking"> Checking...</span>`;

            const res = await fetch(`/check/${currentService}`);
            const data = await res.json();

            statusCell.innerHTML = data.ok
                ? `<span class="success">✔ ${data.message}</span>`
                : `<span class="failure">✖ ${data.message}</span>`;

            currentService++;
            await new Promise(r => setTimeout(r, 800));
        }
    }

    /* ================= INTEGRATION CHECK ================= */

    const totalIntegrations = {{ systems|length }};
    let currentIntegration = 0;

    async function runIntegrationChecks() {
        while (currentIntegration < totalIntegrations) {
            const row = document.getElementById(`integration-row-${currentIntegration}`);
            row.classList.remove("hidden");

            const outCell = row.querySelector(".outbound");
            const inCell = row.querySelector(".inbound");

            outCell.innerHTML = `<span class="spinner"></span>`;
            inCell.innerHTML = `<span class="spinner"></span>`;

            const res = await fetch(`/check-integration/${currentIntegration}`);
            const data = await res.json();

            outCell.innerHTML = data.outbound
                ? `<span class="ok">✔</span>`
                : `<span class="fail">✖</span>`;

            inCell.innerHTML = data.inbound
                ? `<span class="ok">✔</span>`
                : `<span class="fail">✖</span>`;

            currentIntegration++;
            await new Promise(r => setTimeout(r, 800));
        }
    }

    /* ================= START BOTH ================= */

    runServiceChecks();
    runIntegrationChecks();
</script>

</body>
</html>
